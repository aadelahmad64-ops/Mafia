<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>مافيا 2</title>
<style>
  body {background: #111; color: #fff; font-family: sans-serif; text-align: center;}
  h1 {color: red;}
  input, button {padding: 10px; margin: 5px; font-size: 16px;}
  .hidden {display:none;}
  #playersList {margin-top: 10px;}
</style>
</head>
<body>

<h1>مافيا 2</h1>
<p>اكتب اسمك وكود الغرفة للانضمام</p>

<div id="loginDiv">
  <input type="text" id="playerName" placeholder="اسمك">
  <input type="text" id="roomCode" placeholder="كود الغرفة">
  <button id="joinBtn">انضمام</button>
</div>

<div id="gameDiv" class="hidden">
  <h2>مرحبا <span id="myName"></span></h2>
  <p id="roleDisplay"></p>
  <div id="mafiaList" class="hidden">
    <p>المافيا:</p>
    <ul id="mafiaMembers"></ul>
  </div>
  <button id="voteBtn">تصويت</button>
</div>

<script>
// إعداد اللعبة
const ROOM_CODE = "963";
const MIN_PLAYERS = 5;
let players = [];
let roles = {};
let myName = '';
let mafia = [];

document.getElementById('joinBtn').onclick = () => {
  const name = document.getElementById('playerName').value.trim();
  const code = document.getElementById('roomCode').value.trim();
  if(!name){ alert("اكتب اسمك"); return; }
  if(code !== ROOM_CODE){ alert("كود الغرفة خطأ"); return; }

  myName = name;
  players.push(myName);

  // توزيع أدوار عشوائي عند أول لاعب يدخل
  if(players.length >= MIN_PLAYERS){
    startGame();
  } else {
    alert("لازم يكون على الأقل "+MIN_PLAYERS+" لاعبين للبدء");
  }
};

function startGame(){
  // قائمة مؤقتة لتوزيع الأدوار
  let tempPlayers = [...players];

  // 2 مافيا
  for(let i=0;i<2;i++){
    let idx = Math.floor(Math.random()*tempPlayers.length);
    roles[tempPlayers[idx]] = 'مافيا';
    mafia.push(tempPlayers[idx]);
    tempPlayers.splice(idx,1);
  }

  // محقق
  let idx = Math.floor(Math.random()*tempPlayers.length);
  roles[tempPlayers[idx]] = 'محقق';
  tempPlayers.splice(idx,1);

  // دكتور
  idx = Math.floor(Math.random()*tempPlayers.length);
  roles[tempPlayers[idx]] = 'دكتور';
  tempPlayers.splice(idx,1);

  // الباقي مواطنين
  tempPlayers.forEach(p => roles[p] = 'مواطن');

  showRole();
}

function showRole(){
  document.getElementById('loginDiv').classList.add('hidden');
  document.getElementById('gameDiv').classList.remove('hidden');
  document.getElementById('myName').innerText = myName;
  document.getElementById('roleDisplay').innerText = "دورك: " + roles[myName];

  // لو المافيا
  if(roles[myName] === 'مافيا'){
    document.getElementById('mafiaList').classList.remove('hidden');
    const ul = document.getElementById('mafiaMembers');
    mafia.forEach(m => {
      if(m !== myName) {
        const li = document.createElement('li');
        li.innerText = m;
        ul.appendChild(li);
      }
    });
  }
}

// التصويت (نسخة أولية)
document.getElementById('voteBtn').onclick = () => {
  alert("خاصية التصويت رح تتضاف لاحقاً في النسخة الكاملة");
};
</script>

</body>
</html>
